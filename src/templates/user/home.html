{% load i18n %}

{% extends "base_generic.html" %}

{% block title %}Bocchi{% endblock %}

{% block css %}{% endblock %}

{% block javascript %}
<script type="text/javascript">
$(function() {
	$('form').live('submit', function(){
		return false;
	});
	
	$('#home button').live('click', function(){
		var postData = {};
        $('form').find('select').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        $('form').find(':checked').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        
        $.post('/api/update/user_prefs', postData, function(data){
        	if (data.status) {
        		window.location = "bocchi://bocchi.atrac613.io/alert/saved";
        	}
        }, 'JSON');
 
        return false;
	});
	
	$('#bot button').live('click', function(){
		var postData = {};
        $('form').find('select').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        $('form').find('input').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        
        $.post('/api/update/bot', postData, function(data){
        	if (data.status) {
        		window.location = "bocchi://bocchi.atrac613.io/alert/saved";
        	}
        }, 'JSON');
 
        return false;
	});
	
	$('#bot_create button').live('click', function(){
		var bot_id = $('#bot_id').val();
		if(bot_id){
			if(!bot_id.match( /[^0-9A-Za-z]+/ )){
				var postData = {};
		        $('form').find('input').each(function(){
		            postData[$(this).attr('name')] = $(this).val();
		        });
		        
		        $.post('/api/update/bot/add', postData, function(data){
		        	if (data.status) {
		        		//window.location = "bocchi://bocchi.atrac613.io/alert/saved";
		        		$.mobile.changePage("/bot/list", 'slideup');
		        	}
		        }, 'JSON');
		 
		        return false;
			}else{
				alert("Bot ID is only alphanumeric character.");
			}
		}else{
			alert('Bot ID is required.');
		}
 
        return false;
	});
	
	$('#bot_edit button').live('click', function(){
		var postData = {};
        $('form').find('input:hidden').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        $('form').find('input:text').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        $('form').find(':checked').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        
        $.post('/api/update/bot/edit', postData, function(data){
        	if (data.status) {
        		window.location = "bocchi://bocchi.atrac613.io/alert/saved";
        	}
        }, 'JSON');

        return false;
	});
	
	$('#bot_add_message button').live('click', function(){
		var postData = {};
        $('form').find('input:hidden').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        $('form').find('input:text').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        $('form').find('select').each(function(){
            postData[$(this).attr('name')] = $(this).val();
        });
        
        var bot_id = $("#bot_id").val();
        
        $.post('/api/update/bot/add_message', postData, function(data){
        	if (data.status) {
        		$.mobile.changePage("/bot/schedule_list?bot_id=" + bot_id, 'slideup');
        		//window.location = "/bot/schedule_list?bot_id=" + bot_id;
        	}
        }, 'JSON');

        return false;
	});
	
	$('#bot_schedule a').live('click', function(){
	//$('#bot_schedule a').bind('tap',function(){
		if (window.confirm('Are you sure you want to delete?')) {
			//$('form').submit();
			var postData = {};
	        $(this).find('input:hidden').each(function(){
	            postData[$(this).attr('name')] = $(this).val();
	        });
	        var that = this;
	        $.post('/api/update/bot/delete_message', postData, function(data){
	        	if (data.status) {
	        		$(that).hide('slow', function(){ $(this).remove(); });
	        	}
	        }, 'JSON');
 
		}
	});
});
</script>

{% endblock %}

{% block content %}

<div id="home" data-role="page" class="type-interior">
	<div data-role="content">
		<div class="content-primary">
			<form action="/user/home" method="post" data-ajax="false">
				<ul data-role="listview" data-inset="true">
					<li data-role="fieldcontain">
	        			<label for="name">Quantity:</label>
	        			{{ quantity }}
					</li>
					<li data-role="fieldcontain">
	        			<label for="select-choice-1" class="select">{% trans "Daily Max Notify Count" %}:</label>
	        			<select name="daily_max_notify_count" id="select-choice-1">
	        				{% for i in max_notify_list %}
								<option value="{{ i }}" {% ifequal i user_prefs.daily_max_notify_count %} selected="selected"{% endifequal %}>{{ i }}</option>
							{% endfor %}
	        			</select>
					</li>
					<li data-role="fieldcontain">
	        			<fieldset data-role="controlgroup">
	        				<legend>{% trans "Schedule" %}:</legend>
	        				<input type="checkbox" name="checkbox-0000_0300" id="checkbox-1a" class="custom" value="1" />
							<label for="checkbox-1a">00:00 - 03:00</label>
	        			</fieldset>
					</li>
					<li data-role="fieldcontain">
	        			<label for="select-choice-1" class="select">{% trans 'Timezone' %}:</label>
	        			<select name="timezone" id="select-choice-1">
	        				<option value="9">Japan (GMT +0900)</option>
							<option value="-6">US (GMT -0600)</option>
	        			</select>
					</li>
					<li data-role="fieldcontain">
	        			<button type="button" data-theme="a">Submit</button
					</li>
				</ul>
			</form>
			
			<ul data-role="listview" data-inset="true" data-theme="c" data-dividertheme="f">
				<li data-role="list-divider">Bot Menu</li>
				<li><a href="/user/bot">Config</a></li>
				<li><a href="/bot/">Admin</a></li>
			</ul>

		</div>
	</div>
</div>

{% endblock %}